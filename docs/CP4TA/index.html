<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Test Generation Using GitHub Copilot | AI Practitioner</title>
<meta name="generator" content="Jekyll v4.4.1" />
<meta property="og:title" content="Test Generation Using GitHub Copilot" />
<meta name="author" content="John Michael Miller" />
<meta property="og:locale" content="en" />
<meta name="description" content="Using AI in a production application is risky, particularly if you are new to working with NLM-generated code. This post will show how you can get started using AI in a production application by leveraging AI’s ability to generate test automation. If you’re hesitant to apply AI directly to a production codebase, that hesitation is well-grounded. Test automation is one area of your code that is begging for a little help from AI." />
<meta property="og:description" content="Using AI in a production application is risky, particularly if you are new to working with NLM-generated code. This post will show how you can get started using AI in a production application by leveraging AI’s ability to generate test automation. If you’re hesitant to apply AI directly to a production codebase, that hesitation is well-grounded. Test automation is one area of your code that is begging for a little help from AI." />
<link rel="canonical" href="https://blog.pdata.com/CP4TA/" />
<meta property="og:url" content="https://blog.pdata.com/CP4TA/" />
<meta property="og:site_name" content="AI Practitioner" />
<meta property="og:image" content="https://blog.pdata.com/assets/images/2024-12-13/header-CP4TA.jpg" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2024-12-12T16:00:00-08:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="https://blog.pdata.com/assets/images/2024-12-13/header-CP4TA.jpg" />
<meta property="twitter:title" content="Test Generation Using GitHub Copilot" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"John Michael Miller"},"dateModified":"2024-12-12T16:00:00-08:00","datePublished":"2024-12-12T16:00:00-08:00","description":"Using AI in a production application is risky, particularly if you are new to working with NLM-generated code. This post will show how you can get started using AI in a production application by leveraging AI’s ability to generate test automation. If you’re hesitant to apply AI directly to a production codebase, that hesitation is well-grounded. Test automation is one area of your code that is begging for a little help from AI.","headline":"Test Generation Using GitHub Copilot","image":"https://blog.pdata.com/assets/images/2024-12-13/header-CP4TA.jpg","mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.pdata.com/CP4TA/"},"url":"https://blog.pdata.com/CP4TA/"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="https://blog.pdata.com/feed.xml" title="AI Practitioner" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">AI Practitioner</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About</a><a class="page-link" href="/">Home</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Test Generation Using GitHub Copilot</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2024-12-12T16:00:00-08:00" itemprop="datePublished">Dec 12, 2024
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>Using AI in a production application is risky, particularly if you are new to working with NLM-generated code. This post will show how you can get started using AI in a production application by leveraging AI’s ability to generate test automation.</p>

<p>If you’re hesitant to apply AI directly to a production codebase, that hesitation is well-grounded. Test automation is one area of your code that is begging for a little help from AI.</p>

<!--more-->

<p><img src="/assets/images/2024-12-13/header-CP4TA.jpg" alt="Header Image" /> If the codebases that you work in are anything like the codebases I work in, test coverage is always lacking in one way or another, if it exists at all. Leveraging AI in test automation is a good way to add value without incurring significant risk.</p>

<h2 id="safe-because-test-automation-is-not-deployed-to-production">Safe Because Test Automation Is Not Deployed to Production</h2>

<p>The goal of good test automation is to prevent defects from reaching production and it is not intended to be deployed to production. Faulty test automation could return a false positive, failing when it shouldn’t, which is a broken test. That’s an inconvenience but it is not a major issue. The other possibility is a false negative, the test should have failed but didn’t. This is more serious, but is essentially the same as not having a test. Likely the state you’re in now.</p>

<p>An advantage test code has over application code is that in general, test code is simpler than application code. Typically unit test code exercises the interfaces of the code under test and examines the values returned by the code under test. Effective use of stubs and mocks excludes dependent code further simplifying the test. This makes NLM-generated test automation easier to review for completeness and correctness.</p>

<h2 id="test-automation-can-expose-design-and-architecture-issues">Test Automation Can Expose Design and Architecture Issues</h2>

<p>Asking an NLM to generate test automation for your code has the added advantage of providing an extra “pair of eyes” on your code. To an extent, the quality of the generated test code is correlated to the quality of the code being tested. Tests that are simple and straight forward are an indication that the code is testable. If the NLM has trouble generating tests or produces test that are complex or incomplete, it’s a sign that the code is not as testable as it could be and that some refactoring may be in order.</p>

<h2 id="enables-refactoring">Enables Refactoring</h2>

<p>Of course the major benefit from generating tests with an NLM is that, in the end, you have tests! And having tests is an enabler for refactoring and making improvements to the codebase.</p>

<h2 id="scoping-statement">Scoping Statement</h2>

<p>In addition to generating tests to increase code coverage, AI can increase the efficiency, accuracy, and scalability of a test suite. It can run tests faster and more precisely, reducing testing cycles. With predictive analytics, AI can prioritize tests likely to uncover defects, improving overall effectiveness. However to realize these benefits you need tests and this post is focused on unit test generation. We’ll get to these other benefits in due time as well generating other types of tests.</p>

<h2 id="further-scoping-statement">Further Scoping Statement</h2>

<p>There are many ways to generate tests. In this post I’ll focus on using GitHub Copilot to demonstrate the ins and outs of generating test automation and I’ll discuss Copilot’s strengths and weaknesses for this. The concepts are applicable to other NLMs but we won’t be comparing them here.</p>

<h2 id="why-copilot">Why Copilot</h2>

<p>GitHub Copilot is a reasonable choice for generating tests. It is supported in VS Code, Visual Studio, IntelliJ IDEA, Vim, and other IDEs. Integration into an IDE is advantageous as the IDE can expose the code to the NLM making it easy to tell the IDE to generate tests using the NLM for a function, method, class, etc.</p>

<h2 id="our-complex-code-that-needs-testing">Our Complex Code That Needs Testing</h2>

<p>To demonstrate generating automated tests we need code to test. More specifically, we need code that is not trivial and that has some degree of complexity to challenge the NLM’s test generation capabilities. Rather than trying to extract a snippet from an existing codebase or creating something from scratch, I handed the task off to Copilot.</p>

<p>My first attempt was with the prompt: “Can you create a C# class that has a high cyclomatic complexity?” which produced a complex class which would suffice but was based on numeric comparisons and not very readable. I added that “I’m looking for a real-world example” and Copilot produced a class similar to code below, which is much more suitable.</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">BankAccountApp</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">BankAccount</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="kt">decimal</span> <span class="n">Balance</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">private</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="kt">bool</span> <span class="n">IsActive</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">private</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="nf">BankAccount</span><span class="p">(</span><span class="kt">decimal</span> <span class="n">initialBalance</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">Balance</span> <span class="p">=</span> <span class="n">initialBalance</span><span class="p">;</span>
            <span class="n">IsActive</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="kt">decimal</span> <span class="nf">MakeDeposit</span><span class="p">(</span><span class="kt">decimal</span> <span class="n">amount</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="nf">ProcessTransaction</span><span class="p">(</span><span class="s">"Deposit"</span><span class="p">,</span> <span class="n">amount</span><span class="p">);</span>
            <span class="k">return</span> <span class="n">Balance</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="kt">decimal</span> <span class="nf">MakeWithdrawal</span><span class="p">(</span><span class="kt">decimal</span> <span class="n">amount</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="nf">ProcessTransaction</span><span class="p">(</span><span class="s">"Withdraw"</span><span class="p">,</span> <span class="n">amount</span><span class="p">);</span>
            <span class="k">return</span> <span class="n">Balance</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">virtual</span> <span class="k">void</span> <span class="nf">ProcessTransaction</span><span class="p">(</span><span class="kt">string</span> <span class="n">transactionType</span><span class="p">,</span> <span class="kt">decimal</span> <span class="n">amount</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(!</span><span class="n">IsActive</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"Account is inactive."</span><span class="p">);</span>
                <span class="k">return</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">switch</span> <span class="p">(</span><span class="n">transactionType</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">case</span> <span class="s">"Deposit"</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">amount</span> <span class="p">&gt;</span> <span class="m">0</span><span class="p">)</span>
                    <span class="p">{</span>
                        <span class="n">Balance</span> <span class="p">+=</span> <span class="n">amount</span><span class="p">;</span>
                        <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"Deposited: </span><span class="p">{</span><span class="n">amount</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
                    <span class="p">}</span>
                    <span class="k">else</span>
                    <span class="p">{</span>
                        <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"Invalid deposit amount."</span><span class="p">);</span>
                    <span class="p">}</span>
                    <span class="k">break</span><span class="p">;</span>
                <span class="k">case</span> <span class="s">"Withdraw"</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">amount</span> <span class="p">&gt;</span> <span class="m">0</span> <span class="p">&amp;&amp;</span> <span class="n">amount</span> <span class="p">&lt;=</span> <span class="n">Balance</span><span class="p">)</span>
                    <span class="p">{</span>
                        <span class="n">Balance</span> <span class="p">-=</span> <span class="n">amount</span><span class="p">;</span>
                        <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"Withdrew: </span><span class="p">{</span><span class="n">amount</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
                    <span class="p">}</span>
                    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">amount</span> <span class="p">&gt;</span> <span class="n">Balance</span><span class="p">)</span>
                    <span class="p">{</span>
                        <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"Insufficient funds."</span><span class="p">);</span>
                    <span class="p">}</span>
                    <span class="k">else</span>
                    <span class="p">{</span>
                        <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"Invalid withdrawal amount."</span><span class="p">);</span>
                    <span class="p">}</span>
                    <span class="k">break</span><span class="p">;</span>
                <span class="k">default</span><span class="p">:</span>
                    <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"Invalid transaction type."</span><span class="p">);</span>
                    <span class="k">break</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">Balance</span> <span class="p">&lt;</span> <span class="m">0</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">IsActive</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
                <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"Account deactivated due to negative balance."</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">ProcessTransaction</code> method in the <code class="language-plaintext highlighter-rouge">BankAccount</code> class handles two types of transactions: deposits and withdrawals. It first checks if the account is active. If not, it prints a message and exits. For each transaction type, it validates the amount and updates the balance accordingly, printing appropriate messages for each case. If the balance becomes negative, the account is deactivated.</p>

<p>This class is complex enough to require a good amount of test automation to provide adequate code coverage. Tests are needed for each transaction type and each transaction type has different conditions that need to be tested. Also the <code class="language-plaintext highlighter-rouge">IsActive</code> flag and the negative balance conditions need testing.</p>

<p>Copilot gave us complex code, not necessarily clean code and there are opportunities to improve this legacy code. But before we might attempt improvements we should have tests for the current implementation so that we can be confident that any refactoring doesn’t introduce defects.</p>

<h2 id="using-copilot-to-write-unit-tests">Using Copilot to Write Unit Tests</h2>

<p>Copilot has several ways to generate tests. I’m focusing on using the Copilot integration with Visual Studio Code which is fairly representative of other IDEs and techniques.</p>

<h3 id="generating-tests-in-vscode">Generating Tests in VSCode</h3>

<p>In VSCode there are two primary ways to generate tests. You can enter commands in Copilot chat or you can use the right-click menu in a code file and select to generate tests.</p>

<h4 id="generate-tests-for-the-makedepost-method">Generate Tests for the MakeDepost Method</h4>

<p>To generate tests for a single method or function in the Copilot chat, enter a prompt asking Copilot to generate tests for the method or function. For example, the prompt: <code class="language-plaintext highlighter-rouge">Generate unit tests for the MakeDeposit method of the BankAccount class</code> produced the code:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">using</span> <span class="nn">Xunit</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">BankAccountApp</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">BankAccountTests</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">BankAccountTests</span>
    <span class="p">{</span>
        <span class="p">[</span><span class="n">Fact</span><span class="p">]</span>
        <span class="k">public</span> <span class="k">void</span> <span class="nf">MakeDeposit_ShouldIncreaseBalance</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="c1">// Arrange</span>
            <span class="kt">var</span> <span class="n">account</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">BankAccount</span><span class="p">(</span><span class="m">100m</span><span class="p">);</span>

            <span class="c1">// Act</span>
            <span class="kt">var</span> <span class="n">newBalance</span> <span class="p">=</span> <span class="n">account</span><span class="p">.</span><span class="nf">MakeDeposit</span><span class="p">(</span><span class="m">50m</span><span class="p">);</span>

            <span class="c1">// Assert</span>
            <span class="n">Assert</span><span class="p">.</span><span class="nf">Equal</span><span class="p">(</span><span class="m">150m</span><span class="p">,</span> <span class="n">newBalance</span><span class="p">);</span>
            <span class="n">Assert</span><span class="p">.</span><span class="nf">Equal</span><span class="p">(</span><span class="m">150m</span><span class="p">,</span> <span class="n">account</span><span class="p">.</span><span class="n">Balance</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="p">[</span><span class="n">Fact</span><span class="p">]</span>
        <span class="k">public</span> <span class="k">void</span> <span class="nf">MakeDeposit_ShouldNotChangeBalance_WhenAmountIsNegative</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="c1">// Arrange</span>
            <span class="kt">var</span> <span class="n">account</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">BankAccount</span><span class="p">(</span><span class="m">100m</span><span class="p">);</span>

            <span class="c1">// Act</span>
            <span class="kt">var</span> <span class="n">newBalance</span> <span class="p">=</span> <span class="n">account</span><span class="p">.</span><span class="nf">MakeDeposit</span><span class="p">(-</span><span class="m">50m</span><span class="p">);</span>

            <span class="c1">// Assert</span>
            <span class="n">Assert</span><span class="p">.</span><span class="nf">Equal</span><span class="p">(</span><span class="m">100m</span><span class="p">,</span> <span class="n">newBalance</span><span class="p">);</span>
            <span class="n">Assert</span><span class="p">.</span><span class="nf">Equal</span><span class="p">(</span><span class="m">100m</span><span class="p">,</span> <span class="n">account</span><span class="p">.</span><span class="n">Balance</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="add-mocking-to-isolate-dependencies">Add Mocking to Isolate Dependencies</h3>

<p>The <code class="language-plaintext highlighter-rouge">MakeDeposit</code> method calls the <code class="language-plaintext highlighter-rouge">ProcessTransaction</code> method and returns the new balance. As a unit test of the <code class="language-plaintext highlighter-rouge">MakeDeposit</code> method, the functioning of the <code class="language-plaintext highlighter-rouge">ProcessTransaction</code> method should not effect the testing of the <code class="language-plaintext highlighter-rouge">MakeDeposit</code> method and clearly both tests depend on an expected behavior of the <code class="language-plaintext highlighter-rouge">ProcessTransaction</code> method in order to pass.</p>

<p>We can address this with another prompt: <code class="language-plaintext highlighter-rouge">Can you mock the ProcessTransaction method in every MakeDeposit test?</code> which produced new tests that leverage the Moq framework and reflection to remove the dependency on the <code class="language-plaintext highlighter-rouge">ProcessTransaction</code> method:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">using</span> <span class="nn">Xunit</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Moq</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">BankAccountApp</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Reflection</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">BankAccountTests</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">BankAccountTests</span>
    <span class="p">{</span>
        <span class="p">[</span><span class="n">Fact</span><span class="p">]</span>
        <span class="k">public</span> <span class="k">void</span> <span class="nf">MakeDeposit_ShouldCallProcessTransaction</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="c1">// Arrange</span>
            <span class="kt">var</span> <span class="n">mockAccount</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Mock</span><span class="p">&lt;</span><span class="n">BankAccount</span><span class="p">&gt;(</span><span class="m">100m</span><span class="p">)</span> <span class="p">{</span> <span class="n">CallBase</span> <span class="p">=</span> <span class="k">true</span> <span class="p">};</span>

            <span class="c1">// Act</span>
            <span class="n">mockAccount</span><span class="p">.</span><span class="n">Object</span><span class="p">.</span><span class="nf">MakeDeposit</span><span class="p">(</span><span class="m">50m</span><span class="p">);</span>

            <span class="c1">// Assert</span>
            <span class="n">mockAccount</span><span class="p">.</span><span class="nf">Verify</span><span class="p">(</span><span class="n">a</span> <span class="p">=&gt;</span> <span class="n">a</span><span class="p">.</span><span class="nf">ProcessTransaction</span><span class="p">(</span><span class="s">"Deposit"</span><span class="p">,</span> <span class="m">50m</span><span class="p">),</span> <span class="n">Times</span><span class="p">.</span><span class="n">Once</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="p">[</span><span class="n">Fact</span><span class="p">]</span>
        <span class="k">public</span> <span class="k">void</span> <span class="nf">MakeDeposit_ShouldIncreaseBalance</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="c1">// Arrange</span>
            <span class="kt">var</span> <span class="n">mockAccount</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Mock</span><span class="p">&lt;</span><span class="n">BankAccount</span><span class="p">&gt;(</span><span class="m">100m</span><span class="p">)</span> <span class="p">{</span> <span class="n">CallBase</span> <span class="p">=</span> <span class="k">true</span> <span class="p">};</span>
            <span class="n">mockAccount</span><span class="p">.</span><span class="nf">Setup</span><span class="p">(</span><span class="n">a</span> <span class="p">=&gt;</span> <span class="n">a</span><span class="p">.</span><span class="nf">ProcessTransaction</span><span class="p">(</span><span class="s">"Deposit"</span><span class="p">,</span> <span class="m">50m</span><span class="p">)).</span><span class="nf">Callback</span><span class="p">(()</span> <span class="p">=&gt;</span>
            <span class="p">{</span>
                <span class="kt">var</span> <span class="n">balanceProperty</span> <span class="p">=</span> <span class="k">typeof</span><span class="p">(</span><span class="n">BankAccount</span><span class="p">).</span><span class="nf">GetProperty</span><span class="p">(</span><span class="s">"Balance"</span><span class="p">,</span>
                <span class="n">BindingFlags</span><span class="p">.</span><span class="n">Public</span> <span class="p">|</span> <span class="n">BindingFlags</span><span class="p">.</span><span class="n">Instance</span><span class="p">);</span>
                <span class="n">balanceProperty</span><span class="p">.</span><span class="nf">SetValue</span><span class="p">(</span><span class="n">mockAccount</span><span class="p">.</span><span class="n">Object</span><span class="p">,</span> <span class="m">150m</span><span class="p">);</span>
            <span class="p">});</span>

            <span class="c1">// Act</span>
            <span class="kt">var</span> <span class="n">newBalance</span> <span class="p">=</span> <span class="n">mockAccount</span><span class="p">.</span><span class="n">Object</span><span class="p">.</span><span class="nf">MakeDeposit</span><span class="p">(</span><span class="m">50m</span><span class="p">);</span>

            <span class="c1">// Assert</span>
            <span class="n">Assert</span><span class="p">.</span><span class="nf">Equal</span><span class="p">(</span><span class="m">150m</span><span class="p">,</span> <span class="n">newBalance</span><span class="p">);</span>
            <span class="n">Assert</span><span class="p">.</span><span class="nf">Equal</span><span class="p">(</span><span class="m">150m</span><span class="p">,</span> <span class="n">mockAccount</span><span class="p">.</span><span class="n">Object</span><span class="p">.</span><span class="n">Balance</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="p">[</span><span class="n">Fact</span><span class="p">]</span>
        <span class="k">public</span> <span class="k">void</span> <span class="nf">MakeDeposit_ShouldNotChangeBalance_WhenAmountIsNegative</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="c1">// Arrange</span>
            <span class="kt">var</span> <span class="n">mockAccount</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Mock</span><span class="p">&lt;</span><span class="n">BankAccount</span><span class="p">&gt;(</span><span class="m">100m</span><span class="p">)</span> <span class="p">{</span> <span class="n">CallBase</span> <span class="p">=</span> <span class="k">true</span> <span class="p">};</span>
            <span class="n">mockAccount</span><span class="p">.</span><span class="nf">Setup</span><span class="p">(</span><span class="n">a</span> <span class="p">=&gt;</span> <span class="n">a</span><span class="p">.</span><span class="nf">ProcessTransaction</span><span class="p">(</span><span class="s">"Deposit"</span><span class="p">,</span> <span class="p">-</span><span class="m">50m</span><span class="p">)).</span><span class="nf">Callback</span><span class="p">(()</span> <span class="p">=&gt;</span>
              <span class="p">{</span> <span class="cm">/* No change in balance */</span> <span class="p">});</span>

            <span class="c1">// Act</span>
            <span class="kt">var</span> <span class="n">newBalance</span> <span class="p">=</span> <span class="n">mockAccount</span><span class="p">.</span><span class="n">Object</span><span class="p">.</span><span class="nf">MakeDeposit</span><span class="p">(-</span><span class="m">50m</span><span class="p">);</span>

            <span class="c1">// Assert</span>
            <span class="n">Assert</span><span class="p">.</span><span class="nf">Equal</span><span class="p">(</span><span class="m">100m</span><span class="p">,</span> <span class="n">newBalance</span><span class="p">);</span>
            <span class="n">Assert</span><span class="p">.</span><span class="nf">Equal</span><span class="p">(</span><span class="m">100m</span><span class="p">,</span> <span class="n">mockAccount</span><span class="p">.</span><span class="n">Object</span><span class="p">.</span><span class="n">Balance</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h4 id="explaining-the-tests">Explaining the Tests</h4>

<p>The <code class="language-plaintext highlighter-rouge">MakeDeposit_ShouldCallProcessTransaction</code> test is designed to verify that the <code class="language-plaintext highlighter-rouge">MakeDeposit</code> method of the <code class="language-plaintext highlighter-rouge">BankAccount</code> class correctly calls the <code class="language-plaintext highlighter-rouge">ProcessTransaction</code> method with the appropriate parameters. It isolates the <code class="language-plaintext highlighter-rouge">ProcessTransaction</code> method by creating a mock of the <code class="language-plaintext highlighter-rouge">BankAccount</code> class and then verifying that the <code class="language-plaintext highlighter-rouge">ProcessTransaction</code> method of the mocked <code class="language-plaintext highlighter-rouge">BankAccount</code> is called once with the expected parameter value.</p>

<p>The <code class="language-plaintext highlighter-rouge">MakeDeposit_ShouldIncreaseBalance</code> method is designed to verify that the <code class="language-plaintext highlighter-rouge">MakeDeposit</code> method of the <code class="language-plaintext highlighter-rouge">BankAccount</code> class correctly increases the account balance. It isolates the <code class="language-plaintext highlighter-rouge">ProcessTransaction</code> method by creating a mock of the <code class="language-plaintext highlighter-rouge">BankAccount</code> class and implements a mock of the <code class="language-plaintext highlighter-rouge">ProcessTransaction</code> method that assigns the expected value to the <code class="language-plaintext highlighter-rouge">BankAccount.Balance</code> property using reflection.</p>

<p>The <code class="language-plaintext highlighter-rouge">MakeDeposit_ShouldNotChangeBalance_WhenAmountIsNegative</code> test is similar to the <code class="language-plaintext highlighter-rouge">MakeDeposit_ShouldIncreaseBalance</code> test but does not change the balance. Since the <code class="language-plaintext highlighter-rouge">MakeDeposit</code> method has no code that behaves differently when the amount is negative it would be reasonable to drop this test.</p>

<h3 id="generating-tests-for-the-processtransaction-method">Generating Tests for the ProcessTransaction Method</h3>

<p>I used a similar prompt to <code class="language-plaintext highlighter-rouge">Generate unit tests for the ProcesTransaction method of the BankAccount class</code>, which generates these additional tests:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="n">Fact</span><span class="p">]</span>
<span class="k">public</span> <span class="k">void</span> <span class="nf">ProcessTransaction_ShouldIncreaseBalance_OnValidDeposit</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">// Arrange</span>
    <span class="kt">var</span> <span class="n">account</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">BankAccount</span><span class="p">(</span><span class="m">100m</span><span class="p">);</span>

    <span class="c1">// Act</span>
    <span class="n">account</span><span class="p">.</span><span class="nf">ProcessTransaction</span><span class="p">(</span><span class="s">"Deposit"</span><span class="p">,</span> <span class="m">50m</span><span class="p">);</span>

    <span class="c1">// Assert</span>
    <span class="n">Assert</span><span class="p">.</span><span class="nf">Equal</span><span class="p">(</span><span class="m">150m</span><span class="p">,</span> <span class="n">account</span><span class="p">.</span><span class="n">Balance</span><span class="p">);</span>
<span class="p">}</span>

<span class="p">[</span><span class="n">Fact</span><span class="p">]</span>
<span class="k">public</span> <span class="k">void</span> <span class="nf">ProcessTransaction_ShouldNotChangeBalance_OnInvalidDeposit</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">// Arrange</span>
    <span class="kt">var</span> <span class="n">account</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">BankAccount</span><span class="p">(</span><span class="m">100m</span><span class="p">);</span>

    <span class="c1">// Act</span>
    <span class="n">account</span><span class="p">.</span><span class="nf">ProcessTransaction</span><span class="p">(</span><span class="s">"Deposit"</span><span class="p">,</span> <span class="p">-</span><span class="m">50m</span><span class="p">);</span>

    <span class="c1">// Assert</span>
    <span class="n">Assert</span><span class="p">.</span><span class="nf">Equal</span><span class="p">(</span><span class="m">100m</span><span class="p">,</span> <span class="n">account</span><span class="p">.</span><span class="n">Balance</span><span class="p">);</span>
<span class="p">}</span>

<span class="p">[</span><span class="n">Fact</span><span class="p">]</span>
<span class="k">public</span> <span class="k">void</span> <span class="nf">ProcessTransaction_ShouldDecreaseBalance_OnValidWithdrawal</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">// Arrange</span>
    <span class="kt">var</span> <span class="n">account</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">BankAccount</span><span class="p">(</span><span class="m">100m</span><span class="p">);</span>

    <span class="c1">// Act</span>
    <span class="n">account</span><span class="p">.</span><span class="nf">ProcessTransaction</span><span class="p">(</span><span class="s">"Withdraw"</span><span class="p">,</span> <span class="m">50m</span><span class="p">);</span>

    <span class="c1">// Assert</span>
    <span class="n">Assert</span><span class="p">.</span><span class="nf">Equal</span><span class="p">(</span><span class="m">50m</span><span class="p">,</span> <span class="n">account</span><span class="p">.</span><span class="n">Balance</span><span class="p">);</span>
<span class="p">}</span>

<span class="p">[</span><span class="n">Fact</span><span class="p">]</span>
<span class="k">public</span> <span class="k">void</span> <span class="nf">ProcessTransaction_ShouldNotChangeBalance_OnInvalidWithdrawal</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">// Arrange</span>
    <span class="kt">var</span> <span class="n">account</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">BankAccount</span><span class="p">(</span><span class="m">100m</span><span class="p">);</span>

    <span class="c1">// Act</span>
    <span class="n">account</span><span class="p">.</span><span class="nf">ProcessTransaction</span><span class="p">(</span><span class="s">"Withdraw"</span><span class="p">,</span> <span class="p">-</span><span class="m">50m</span><span class="p">);</span>

    <span class="c1">// Assert</span>
    <span class="n">Assert</span><span class="p">.</span><span class="nf">Equal</span><span class="p">(</span><span class="m">100m</span><span class="p">,</span> <span class="n">account</span><span class="p">.</span><span class="n">Balance</span><span class="p">);</span>
<span class="p">}</span>

<span class="p">[</span><span class="n">Fact</span><span class="p">]</span>
<span class="k">public</span> <span class="k">void</span> <span class="nf">ProcessTransaction_ShouldNotChangeBalance_OnInsufficientFundsWithdrawal</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">// Arrange</span>
    <span class="kt">var</span> <span class="n">account</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">BankAccount</span><span class="p">(</span><span class="m">100m</span><span class="p">);</span>

    <span class="c1">// Act</span>
    <span class="n">account</span><span class="p">.</span><span class="nf">ProcessTransaction</span><span class="p">(</span><span class="s">"Withdraw"</span><span class="p">,</span> <span class="m">150m</span><span class="p">);</span>

    <span class="c1">// Assert</span>
    <span class="n">Assert</span><span class="p">.</span><span class="nf">Equal</span><span class="p">(</span><span class="m">100m</span><span class="p">,</span> <span class="n">account</span><span class="p">.</span><span class="n">Balance</span><span class="p">);</span>
<span class="p">}</span>

<span class="p">[</span><span class="n">Fact</span><span class="p">]</span>
<span class="k">public</span> <span class="k">void</span> <span class="nf">ProcessTransaction_ShouldDeactivateAccount_OnZeroBalance</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">// Arrange</span>
    <span class="kt">var</span> <span class="n">account</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">BankAccount</span><span class="p">(</span><span class="m">50m</span><span class="p">);</span>

    <span class="c1">// Act</span>
    <span class="n">account</span><span class="p">.</span><span class="nf">ProcessTransaction</span><span class="p">(</span><span class="s">"Withdraw"</span><span class="p">,</span> <span class="m">50m</span><span class="p">);</span>

    <span class="c1">// Assert</span>
    <span class="n">Assert</span><span class="p">.</span><span class="nf">False</span><span class="p">(</span><span class="n">account</span><span class="p">.</span><span class="n">IsActive</span><span class="p">);</span>
    <span class="n">Assert</span><span class="p">.</span><span class="nf">Equal</span><span class="p">(</span><span class="m">0m</span><span class="p">,</span> <span class="n">account</span><span class="p">.</span><span class="n">Balance</span><span class="p">);</span>
<span class="p">}</span>

<span class="p">[</span><span class="n">Fact</span><span class="p">]</span>
<span class="k">public</span> <span class="k">void</span> <span class="nf">ProcessTransaction_ShouldNotProcessTransaction_OnInactiveAccount</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">// Arrange</span>
    <span class="kt">var</span> <span class="n">account</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">BankAccount</span><span class="p">(</span><span class="m">0m</span><span class="p">);</span>
    <span class="n">account</span><span class="p">.</span><span class="nf">ProcessTransaction</span><span class="p">(</span><span class="s">"Withdraw"</span><span class="p">,</span> <span class="m">1m</span><span class="p">);</span> <span class="c1">// Deactivate account</span>

    <span class="c1">// Act</span>
    <span class="n">account</span><span class="p">.</span><span class="nf">ProcessTransaction</span><span class="p">(</span><span class="s">"Deposit"</span><span class="p">,</span> <span class="m">50m</span><span class="p">);</span>

    <span class="c1">// Assert</span>
    <span class="n">Assert</span><span class="p">.</span><span class="nf">Equal</span><span class="p">(</span><span class="m">0m</span><span class="p">,</span> <span class="n">account</span><span class="p">.</span><span class="n">Balance</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Running these tests shows that two of these tests, <code class="language-plaintext highlighter-rouge">ProcessTransaction_ShouldNotProcessTransaction_OnInactiveAccount</code> and <code class="language-plaintext highlighter-rouge">ProcessTransaction_ShouldDeactivateAccount_OnZeroBalance</code> are failing. These tests both depend on the state of the <code class="language-plaintext highlighter-rouge">IsActive</code> flag. A closer look at the code shows that the <code class="language-plaintext highlighter-rouge">IsActive</code> flag is set after the transactions types are handled when the balance is less than zero. The “Withdraw” transaction has a condition that prevents updating the balance if the amount is greater than the balance. The balance can never be zero and the <code class="language-plaintext highlighter-rouge">IsActive</code> flag will never be cleared. Copilot found a bug!</p>

<h2 id="copilot-conundrums">Copilot Conundrums</h2>

<p>I’ve found that Copilot generated tests sometimes fail due to problems with the test implementation. The test will raise an unexpected error or an assertion will fail unexpectedly. I’ve found that using the error message or test output as a prompt in the same context will eventually resolve the problem. I ran across this when adding mocks to the <code class="language-plaintext highlighter-rouge">MakeDeposit</code> method. At first the test failed trying to set the <code class="language-plaintext highlighter-rouge">Balance</code> in the mock. The <code class="language-plaintext highlighter-rouge">Balance</code> is private and can only be set within the class. Eventually Copilot arrived at a solution using reflection.</p>

<p>I’ve also found that when Copilot has trouble generating tests it can be an indication that the code is not easily testable. I’ve found instances where Copilot struggles to generate working mocks or that the mocking required to properly test the code is excessive. If you find that the complexity of the test code is equal to or exceeding the code under test, you may have no choice but to refactor the code before generating tests.</p>

<h2 id="conclusion">Conclusion</h2>

<p>Leveraging GitHub Copilot for test automation offers numerous benefits, including increased test coverage, efficiency, and accuracy. By generating tests, Copilot can help identify design and architecture issues, enabling refactoring and other improvements to the codebase. Copilot, integrated with popular IDEs, provides a practical solution for generating unit tests, as demonstrated with the <code class="language-plaintext highlighter-rouge">BankAccount</code> class example. While AI-generated tests may sometimes require adjustments, they ultimately contribute to a more robust and maintainable codebase. Embracing Copilot for test automation can significantly enhance the development process, making it more efficient and reliable.</p>

<h3 id="feedback-loop">Feedback Loop</h3>

<p>Feedback is always welcome. Please direct it to <a href="mailto:AIP@pdata.com" target="_blank">AIP@pdata.com</a></p>

<h5 id="disclaimer">Disclaimer</h5>

<p><small>AI contributed to the writing of this blog post.</small></p>

<p><small>Prompts: </small></p>

<ul>
  <li><small>Create a summary paragraph for why AI is good for test automation. </small></li>
  <li><small>Create an outline for why AI is good for test automation. </small></li>
  <li><small>What IDEs does GitHub Copilot support? </small></li>
  <li><small>Can you create a C# class that has a high cyclomatic complexity? </small>
    <ul>
      <li><small>I’m looking for a real world example </small></li>
    </ul>
  </li>
  <li><small>@workspace /explain the MakeDeposit_ShouldCallProcessTransaction method of the BankAccountTests class </small></li>
  <li><small>@workspace /explain the MakeDeposit_ShouldIncreaseBalance method of the BankAccountTests class </small></li>
  <li><small>Generate a conclusion for this post </small></li>
</ul>

<p><small><small><small>Original <a href="https://www.codemag.com/blog/AIPractitioner/CP4TA">post</a></small></small></small></p>

  </div><a class="u-url" href="/CP4TA/" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">AI Practitioner</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">John Michael Miller</li><li><a class="u-email" href="mailto:AIPractitioner@pdata.com">AIPractitioner@pdata.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>jMM&#39;s AI Practitioner Blog</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
